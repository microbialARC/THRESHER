import os
import sys

BASE_PATH = os.path.dirname(os.path.abspath(workflow.snakefile))

# Get the genome name from the input genome path
ancestor_path = config["ancestor"]
ancestor_name = os.path.splitext(os.path.basename(ancestor_path))[0]

rule all:
    input:
        # Phylogeny Simulation
        os.path.join(config["output"], "treesim", "simu_tree.nwk"),
        # Intermediate files of Evolution Simulator
        os.path.join(config["output"], "evo_simulator", "intermediate", "chromosome_bins.csv"),
        os.path.join(config["output"], "evo_simulator", "intermediate", "dichotomies.txt"),
        os.path.join(config["output"], "evo_simulator", "intermediate", "names.txt"),
        os.path.join(config["output"], "evo_simulator", "intermediate", "nu.txt"),
        os.path.join(config["output"], "evo_simulator", "intermediate", "renamed.txt"),
        os.path.join(config["output"], "evo_simulator", "intermediate", "rm.txt"),
        os.path.join(config["output"], "evo_simulator", "intermediate", "roots.txt"),
        os.path.join(config["output"], "evo_simulator", "intermediate", "weight_mutation.csv"),
        # Final output files of Evolution Simulator
        os.path.join(config["output"], "evo_simulator", "output", "stats.txt"),
        os.path.join(config["output"], "evo_simulator", "output", "mutations.csv"),
        os.path.join(config["output"], "evo_simulator", "output", "gain.csv"),
        os.path.join(config["output"], "evo_simulator", "output", "loss.csv"),
        os.path.join(config["output"], "evo_simulator", "output", "recombination.csv"),
        os.path.join(config["output"], "evo_simulator", "output", "simulated_genomes.fasta"),
        os.path.join(config["output"], "evo_simulator", "output", "snp_matrix.txt"),
        # Visualization files
        # The visualization is generated only when --use_weighted_mutation and --use_gain_loss are both set to True
        os.path.join(config["output"], "evo_simulator", "output", "snp_matrix_visualization.pdf") if config["use_weighted_mutation"] and config["use_gain_loss"] else [],
        os.path.join(config["output"], "evo_simulator", "output", "simulation_visualization.png") if config["use_weighted_mutation"] and config["use_gain_loss"] else [],

include: os.path.join(BASE_PATH, "rules", "treesim.smk")
include: os.path.join(BASE_PATH, "rules", "simulator_input.smk")
include: os.path.join(BASE_PATH, "rules", "simulator_simulation.smk")
if config["use_weighted_mutation"] and config["use_gain_loss"]:
    include: os.path.join(BASE_PATH, "rules", "simulator_visualization.smk")